apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard
  namespace: tfg-iot
  labels:
    grafana_dashboard: "1"
data:
  Dashboard_TFG_Simplificado_Tabla_Posicion.json: |
    {
      "id": null,
      "uid": null,
      "title": "Dashboard TFG IoT - Versi\u00f3n Simplificada",
      "timezone": "browser",
      "schemaVersion": 36,
      "version": 0,
      "refresh": "10s",
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m"
        ]
      },
      "templating": {
        "list": [
          {
            "name": "id_casa",
            "type": "query",
            "label": "Casa",
            "datasource": "CrateDB",
            "query": "SELECT DISTINCT id_casa FROM iot_data",
            "refresh": 1,
            "includeAll": false,
            "multi": false,
            "sort": 1
          },
          {
            "name": "sensor_binario",
            "type": "custom",
            "label": "Sensor Binario",
            "query": "1,2,3,4,5,6,7,8,9",
            "includeAll": false,
            "multi": false,
            "current": {
              "text": "1",
              "value": "1"
            }
          }
        ]
      },
      "panels": [
        {
          "datasource": "CrateDB",
          "title": "Temperatura",
          "type": "timeseries",
          "id": 8279,
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 0
          },
          "fieldConfig": {
            "defaults": {
              "unit": "celsius",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  }
                ]
              }
            },
            "overrides": []
          },
          "targets": [
            {
              "refId": "A",
              "datasource": "CrateDB",
              "rawSql": "\n                SELECT time as \"time\", valor['temperature']\n                FROM iot_data\n                WHERE tipo_dato = 'temperatura'\n                  AND $__timeFilter(time)\n                  AND id_casa = '$id_casa'\n                ORDER BY time ASC\n            ",
              "format": "time_series"
            }
          ]
        },
        {
          "datasource": "CrateDB",
          "title": "Humedad",
          "type": "timeseries",
          "id": 4267,
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 0
          },
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  }
                ]
              }
            },
            "overrides": []
          },
          "targets": [
            {
              "refId": "B",
              "datasource": "CrateDB",
              "rawSql": "\n                SELECT time as \"time\", valor['humidity']\n                FROM iot_data\n                WHERE tipo_dato = 'humedad'\n                  AND $__timeFilter(time)\n                  AND id_casa = '$id_casa'\n                ORDER BY time ASC\n            ",
              "format": "time_series"
            }
          ]
        },
        {
          "datasource": "CrateDB",
          "title": "Saturaci\u00f3n O\u2082",
          "type": "timeseries",
          "id": 6237,
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 8
          },
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  }
                ]
              }
            },
            "overrides": []
          },
          "targets": [
            {
              "refId": "C",
              "datasource": "CrateDB",
              "rawSql": "\n                SELECT time as \"time\", valor['oxygen_saturation']\n                FROM iot_data\n                WHERE tipo_dato = 'saturacion_oxigeno'\n                  AND $__timeFilter(time)\n                  AND id_casa = '$id_casa'\n                ORDER BY time ASC\n            ",
              "format": "time_series"
            }
          ]
        },
        {
          "datasource": "CrateDB",
          "title": "Frecuencia Cardiaca",
          "type": "timeseries",
          "id": 2755,
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 8
          },
          "fieldConfig": {
            "defaults": {
              "unit": "bpm",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  }
                ]
              }
            },
            "overrides": []
          },
          "targets": [
            {
              "refId": "D",
              "datasource": "CrateDB",
              "rawSql": "\n                SELECT time as \"time\", valor['heart_rate']\n                FROM iot_data\n                WHERE tipo_dato = 'heart_rate'\n                  AND $__timeFilter(time)\n                  AND id_casa = '$id_casa'\n                ORDER BY time ASC\n            ",
              "format": "time_series"
            }
          ]
        },
        {
          "datasource": "CrateDB",
          "title": "Certainty Posici\u00f3n",
          "type": "timeseries",
          "id": 7462,
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 16
          },
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  }
                ]
              }
            },
            "overrides": []
          },
          "targets": [
            {
              "refId": "E",
              "datasource": "CrateDB",
              "rawSql": "\n                SELECT time as \"time\", valor['certainty']\n                FROM iot_data\n                WHERE tipo_dato = 'posicion'\n                  AND $__timeFilter(time)\n                  AND id_casa = '$id_casa'\n                ORDER BY time ASC\n            ",
              "format": "time_series"
            }
          ]
        },
        {
          "datasource": "CrateDB",
          "title": "Sensor Binario Seleccionado",
          "type": "timeseries",
          "id": 9999,
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 24
          },
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  }
                ]
              }
            },
            "overrides": []
          },
          "targets": [
            {
              "refId": "Z",
              "datasource": "CrateDB",
              "rawSql": "\n            SELECT time as \"time\", valor[concat('sensor_', '$sensor_binario')]::integer\n            FROM iot_data\n            WHERE tipo_dato = 'binarios'\n              AND $__timeFilter(time)\n              AND id_casa = '$id_casa'\n            ORDER BY time ASC\n        ",
              "format": "time_series"
            }
          ]
        },
        {
          "datasource": "CrateDB",
          "title": "Tabla de Coordenadas (x1, y1, x2, y2)",
          "type": "table",
          "id": 8889,
          "gridPos": {
            "h": 10,
            "w": 24,
            "x": 0,
            "y": 32
          },
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "custom": {}
            },
            "overrides": []
          },
          "targets": [
            {
              "refId": "T",
              "datasource": "CrateDB",
              "rawSql": "\n            SELECT time,\n                   valor['x1'] AS x1,\n                   valor['y1'] AS y1,\n                   valor['x2'] AS x2,\n                   valor['y2'] AS y2\n            FROM iot_data\n            WHERE tipo_dato = 'posicion'\n              AND $__timeFilter(time)\n              AND id_casa = '$id_casa'\n            ORDER BY time DESC\n        ",
              "format": "table"
            }
          ]
        }
      ]
    }
